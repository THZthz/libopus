<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="matter.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
    <style>
        body {
            background: #222;
        }

        canvas {
            margin: 0;
            max-width: 100%;
            border-radius: 3px;
        }

        canvas:active {
            cursor: pointer;
            /*cursor: -webkit-grabbing;*/
        }

        #canvas-container {
            margin: 0px 0;
        }
    </style>
</head>
<body>
<div id="canvas-container"></div>
<script>
    /*
  Uses matter.js. decomp.js for convex object
 */

    window.enablePhysics = 0;

    var colorBall = "#DDD";
    var colorGear = "#323232";
    var colorStop = "#282828";
    var colorWall = "#555";

    var Engine = Matter.Engine,
        Render = Matter.Render,
        Runner = Matter.Runner,
        World = Matter.World,
        Bodies = Matter.Bodies,
        Body = Matter.Body,
        Collision = Matter.Collision,
        Events = Matter.Events,
        Constraint = Matter.Constraint,
        Composite = Matter.Composite,
        Vertices = Matter.Vertices;
    path = []

    document.addEventListener("mousemove", e => {
    })

    document.addEventListener("mousedown", e => {
        allBodies = Composite.allBodies(engine.world);
        for (let i = 0; i < allBodies.length; i++) {
            if (allBodies[i].id === 0) {
                Body.setPosition(allBodies[i], {x: e.clientX, y: e.clientY});
                Body.setAngle(allBodies[i], 2);
            }
        }
    })

    document.addEventListener("DOMContentLoaded", function () {

        b1 = Body.create({vertices: [{x: 439, y: 109}, {x: 400, y: 126}, {x: 416, y: 192}, {x: 501, y: 116}]})
        Body.setPosition(b1, {x: 100, y: 100})
        b2 = Body.create({vertices: [{x: 244, y: 161}, {x: 327, y: 164}, {x: 336, y: 270}, {x: 261, y: 323}, {x: 138, y: 245}]})
        Body.setPosition(b2, {x: 100, y: 100})
        document.body.innerHTML = "<div id='container'></div>";

        // create a Matter.js engine
        engine = Engine.create(),
            world = engine.world;

        engine.gravity.y = 1;
        engine.gravity.scale = 0.001;
        engine.isFixed = 1;

        render = Render.create({
            element: document.getElementById("container"),
            engine: engine,
            options: {
                width: 800,
                height: 800,
                showAngleIndicator: false,
                showVelocity: false,/*
                showCollisions: true,*/
                wireframes: true,
                wireframeBackground: true,
                background: true,
            }
        });


        Render.run(render);

        runner = Runner.create();
        Runner.run(runner, engine);

        w1 = Bodies.rectangle(400, 580, 580, 20, {isStatic: true})
        World.add(engine.world, [b1,/* b2,*/
            w1,
            /*   Bodies.rectangle(400, 10, 780, 10, {isStatic : true}),
               Bodies.rectangle(10, 400, 10, 780, {isStatic : true}),
               Bodies.rectangle(780, 400, 10, 780, {isStatic : true}),*/
        ]);
        /*  for (var x =0;x < 5; x++)
              for (var y = 0; y < 5; y++)
                  World.add(engine.world, Bodies.rectangle(x * 20 + 100, y * 20 + 100, 20, 20));*/

        Events.on(engine, "afterUpdate", e => {
            window.ctx = render.context
            window.c = Collision.collides(b1, w1, null)
            for (var i = 0; i < w1.vertices.length; i++) {
                ctx.fillStyle = "red"
                ctx.fillText("" + i, w1.vertices[i].x, w1.vertices[i].y);
            }
            if (c) {
                ctx.beginPath()

                for (var i = 0; i < c.supports.length; i++)
                    ctx.arc(c.supports[i].x, c.supports[i].y, 4, 0, 2 * Math.PI);
                ctx.fillStyle = "red";
                ctx.fill();
            }
            ctx.beginPath()

            for (var i = 0; i < 1 && window._supports.length; i++) {
                ctx.arc(_supports[i].x, _supports[i].y, 3, 0, 2 * 3.14);
            }
            ctx.fillStyle = "blue";
            ctx.fill();

           if (c) {
               var nx = c.normal.x * 20, ny = c.normal.y * 20;
               ctx.beginPath();
               ctx.moveTo(_supports[0].x, _supports[0].y);
               ctx.lineTo(_supports[0].x + nx, _supports[0].y + ny);
               ctx.stroke();
           }

        });
    });
</script>
</body>
</html>